<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="InquiryMapper">
	<resultMap type="Inquiry" id="inquiryResultMap">
		<id property="inquiriesNo" column="INQUIRIES_NO"/>
		<result property="bookNo" column="BOOK_NO"/>
		<result property="userNo" column="USER_NO"/>
		<result property="inquiriesCategory" column="INQUIRIES_CATEGORY"/>
		<result property="inquiriesTitle" column="INQUIRIES_TITLE"/>
		<result property="inquiriesContent" column="INQUIRIES_CONTENT"/>
		<result property="qCreateDate" column="Q_CREATE_DATE"/>
		<result property="qUpdateDate" column="Q_UPDATE_DATE"/>
		<result property="inquiriesViews" column="INQUIRIES_VIEWS"/>
		<result property="inquiriesFilename" column="INQUIRIES_FILENAME"/>
		<result property="inquiriesFilepath" column="INQUIRIES_FILEPATH"/>
		<result property="inquiriesFilerename" column="INQUIRIES_FILERENAME"/>
		<result property="inquiriesSecret" column="INQUIRIES_SECRET"/>
		<result property="inquiriesLikes" column="INQUIRIES_LIKES"/>
		<result property="secretNo" column="SECRET_NO"/>
	</resultMap>
<!-- 	Join용 resultMap -->
	<resultMap type="InquiryJoin" id="inquiryJoinResultMap">
		<id property="inquiriesNo" column="INQUIRIES_NO"/>
		<result property="bookNo" column="BOOK_NO"/>
		<result property="userNo" column="USER_NO"/>
		<result property="inquiriesCategory" column="INQUIRIES_CATEGORY"/>
		<result property="inquiriesTitle" column="INQUIRIES_TITLE"/>
		<result property="inquiriesContent" column="INQUIRIES_CONTENT"/>
		<result property="qCreateDate" column="Q_CREATE_DATE"/>
		<result property="qUpdateDate" column="Q_UPDATE_DATE"/>
		<result property="inquiriesViews" column="INQUIRIES_VIEWS"/>
		<result property="inquiriesFilename" column="INQUIRIES_FILENAME"/>
		<result property="inquiriesFilepath" column="INQUIRIES_FILEPATH"/>
		<result property="inquiriesFilerename" column="INQUIRIES_FILERENAME"/>
		<result property="inquiriesSecret" column="INQUIRIES_SECRET"/>
		<result property="inquiriesLikes" column="INQUIRIES_LIKES"/>
		<result property="userName" column="USER_NAME"/>
		<result property="secretNo" column="SECRET_NO"/>
	</resultMap>
	
<!-- 	문의사항 리스트 -->
	<select id="selectAllInquiry" resultMap="inquiryJoinResultMap">
		SELECT I.*, U.USER_NAME FROM INQUIRIES_TBL I JOIN USER_TBL U ON I.USER_NO = U.USER_NO ORDER BY Q_CREATE_DATE DESC
	</select>
	
<!-- 	페이징처리(문의사항 총 갯수) -->
	<select id="getInquiryCount" resultType="_int">
		SELECT COUNT(*) FROM INQUIRIES_TBL
	</select>
	
<!-- 	페이징처리(문의사항 검색 총 갯수) -->
	<select id="getSearchInquiryCount" resultType="_int">
		SELECT COUNT(*) FROM INQUIRIES_TBL 
		<where>
			<if test="searchCondition == 'title'">INQUIRIES_TITLE LIKE '%' || #{searchValue} || '%'</if>
			<if test="searchCondition == 'content'">INQUIRIES_CONTENT LIKE '%' || #{searchValue} || '%'</if>
		</where>
	</select>
	
<!-- 	문의사항 검색 리스트 -->
	<select id="searchInquiry" resultMap="inquiryJoinResultMap">
		SELECT I.*, U.USER_NAME FROM INQUIRIES_TBL I JOIN USER_TBL U ON I.USER_NO = U.USER_NO
		<where>
			<if test="searchCondition == 'title'">INQUIRIES_TITLE LIKE '%' || #{searchValue} || '%'</if>
			<if test="searchCondition == 'content'">INQUIRIES_CONTENT LIKE '%' || #{searchValue} || '%'</if>
		</where>
		ORDER BY Q_CREATE_DATE DESC
	</select>
	
<!-- 	문의사항 등록 -->
	<insert id="insertInquiry">
		INSERT INTO INQUIRIES_TBL VALUES(SEQ_INQUIRIES_NO.NEXTVAL, NULL, #{userNo}, #{inquiriesCategory}, #{inquiriesTitle}, #{inquiriesContent}, DEFAULT, NULL, DEFAULT, #{inquiriesFilename}, #{inquiriesFilepath}, #{inquiriesFilerename}, #{inquiriesSecret}, DEFAULT, #{secretNo})
	</insert>
	
<!--	문의사항 디테일-->
	<select id="detailInquiry" resultMap="inquiryJoinResultMap">
		SELECT I.*, U.USER_NAME FROM INQUIRIES_TBL I JOIN USER_TBL U ON I.USER_NO = U.USER_NO WHERE INQUIRIES_NO = #{inquiriesNo}
	</select>
	
<!-- 	문의사항 비밀번호체크 -->
	<select id="checkSecretNo" resultMap="inquiryJoinResultMap">
		SELECT I.*, U.USER_NAME FROM INQUIRIES_TBL I JOIN USER_TBL U ON I.USER_NO = U.USER_NO WHERE INQUIRIES_NO = #{inquiriesNo} AND SECRET_NO = #{secretNo}
	</select>
	
<!-- 	문의사항 수정 -->
	<update id="modifyInquiry">
		UPDATE INQUIRIES_TBL SET INQUIRIES_CATEGORY = #{inquiriesCategory}, INQUIRIES_TITLE = #{inquiriesTitle}, INQUIRIES_CONTENT = #{inquiriesContent}, Q_UPDATE_DATE = DEFAULT, INQUIRIES_FILENAME = NULL, INQUIRIES_FILEPATH = #{inquiriesFilepath}, INQUIRIES_FILERENAME = #{inquiriesFilerename}, SECRET_NO = #{secretNo} WHERE INQUIRIES_NO = #{inquiriesNo}
	</update>
	
<!-- 	문의사항 삭제 -->
	<delete id="deleteInquiry">
		DELETE FROM INQUIRIES_TBL WHERE INQUIRIES_NO = #{inquiriesNo}
	</delete>
</mapper>