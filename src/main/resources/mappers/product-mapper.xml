<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ProductMapper">

	<resultMap type="Product" id="productResultMap">
		<id property="productNo" column="PRODUCT_NO"/>
		<result property="categoryNo" column="CATEGORY_NO"/>
		<result property="productName" column="PRODUCT_NAME"/>
		<result property="productPrice" column="PRODUCT_PRICE"/>
		<result property="productDescription" column="PRODUCT_DESCRIPTION"/>
		<result property="productFilename1" column="PRODUCT_FILENAME1"/>
		<result property="productFilename2" column="PRODUCT_FILENAME2"/>
		<result property="productFilepath1" column="PRODUCT_FILEPATH1"/>
		<result property="productFilepath2" column="PRODUCT_FILEPATH2"/>
	</resultMap>
	<resultMap type="Category" id="categoryResultMap">
		<id property="categoryNo" column="CATEGORY_NO"/>
		<result property="categoryName" column="CATEGORY_NAME"/>
	</resultMap>

	<!--페이징 처리-->
	<select id="getListCount" resultType="_int">
		SELECT COUNT(*) FROM PRODUCT_TBL
	</select>
	
	<!--카테고리 별 상품 목록 전체 조회-->
	<select id="getListCountByCate" resultType="_int">
		SELECT COUNT(*) FROM PRODUCT_TBL 
		WHERE CATEGORY_NO IN  
		<foreach collection="array" index="index" item="item" open="(" separator="," close=")">
			#{item}
		</foreach>
	</select>
	
	<!--조건부 검색-->
	<select id="getSearchListCount" resultType="_int">
		SELECT COUNT(*) FROM PRODUCT_TBL
		<choose>
			<when test="searchCondition == 'no'">
				WHERE PRODUCT_NO LIKE '%' || #{searchValue} || '%'
			</when>
			<when test="searchCondition == 'title'">
				WHERE PRODUCT_NAME LIKE '%' || #{searchValue} || '%'
			</when>
			<when test="searchCondition == 'description'">
				WHERE PRODUCT_DESCRIPTION LIKE '%' || #{searchValue} || '%'
			</when>
		</choose>
	</select>
	
	<!--상품 목록 전체 조회-->
	<select id="selectProductList" resultMap="productResultMap">
	  SELECT PRODUCT_NO, PRODUCT_NAME, PRODUCT_PRICE, PRODUCT_FILENAME1
	  FROM PRODUCT_TBL
	  ORDER BY CATEGORY_NO
	</select>
	
	<!--상품 1차 카테고리 목록 조회-->
	<select id="selectCateProduct1" resultMap="productResultMap">
	    SELECT 
	        P.PRODUCT_NO, P.PRODUCT_NAME, P.CATEGORY_NO, C.CATEGORY_NO, C.CATEGORY_NAME,
	        PRODUCT_PRICE, PRODUCT_DESCRIPTION, PRODUCT_FILENAME1
	    FROM PRODUCT_TBL P
	        INNER JOIN CATEGORY_TBL C
	        ON P.CATEGORY_NO = C.CATEGORY_NO
	    WHERE P.CATEGORY_NO IN
	        <foreach collection="array" index="index" item="item" open="(" separator="," close=")">
	            #{item}
	        </foreach>
	</select>

	<!--상품 2차 카테고리 목록 조회-->
	<select id="selectCateProduct2" resultMap="productResultMap">
		SELECT 
		    P.PRODUCT_NO, P.PRODUCT_NAME, P.CATEGORY_NO, C.CATEGORY_NO, C.CATEGORY_NAME,
		    PRODUCT_PRICE, PRODUCT_DESCRIPTION, PRODUCT_FILENAME1
		FROM PRODUCT_TBL P
		    INNER JOIN CATEGORY_TBL C
		    ON P.CATEGORY_NO = C.CATEGORY_NO
		WHERE P.CATEGORY_NO = #{CATEGORY_NO}
	</select>

	<!--검색 결과 조회-->
	<select id="selectListByKeyword" resultMap="productResultMap">
		SELECT * FROM PRODUCT_TBL 
		<if test="searchCondition == 'all'">
			WHERE PRODUCT_NO LIKE '%' || #{searchValue} || '%'
			OR PRODUCT_NAME LIKE '%' || #{searchValue} || '%'
			OR PRODUCT_DESCRIPTION LIKE '%' || #{searchValue} || '%'
		</if>
		<if test="searchCondition == 'no'">
			WHERE PRODUCT_NO LIKE '%' || #{searchValue} || '%'
		</if>
		<if test="searchCondition == 'title'">
			WHERE PRODUCT_NAME LIKE '%' || #{searchValue} || '%'
		</if>
		<if test="searchCondition == 'description'">
			WHERE PRODUCT_DESCRIPTION LIKE '%' || #{searchValue} || '%'
		</if>
		ORDER BY PRODUCT_NO DESC
	</select>
	
	<!--상품 상세 조회-->
	<select id="selectOneByNo" resultMap="productResultMap">
		SELECT * FROM PRODUCT_TBL WHERE PRODUCT_NO = #{productNo}
	</select>
</mapper>